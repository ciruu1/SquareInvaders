-- Bloque principal

library IEEE;
use IEEE.STD_LOGIC_1164.ALL;
use IEEE.STD_LOGIC_ARITH.ALL;
use IEEE.std_logic_unsigned.all;

entity game is
    Port (
        clk : in STD_LOGIC;                          --Clock
        vgaRed : out STD_LOGIC_VECTOR(3 downto 0);
        vgaBlue : out STD_LOGIC_VECTOR(3 downto 0);
        vgaGreen : out STD_LOGIC_VECTOR(3 downto 0);
        Hsync : out STD_LOGIC;
        Vsync : out STD_LOGIC;
        reset : in STD_LOGIC;                        --Reset
        miso : in     STD_LOGIC;                     --SPI master in, slave out
        mosi : out    STD_LOGIC;                     --SPI master out, slave in
        sclk : buffer STD_LOGIC;                     --SPI clock
        cs_n : out    STD_LOGIC                      --pmod chip select
    );
end game;

architecture Behavioral of game is

    -- NAVE
    signal posX : natural range 0 to 1280; --Posición X de la nave
    signal posY : natural range 0 to 1024; --Posición Y de la nave
    signal clkShip: std_logic;
    signal lives: natural range 0 to 3 := 3;
    signal shoot: STD_LOGIC;               --Señal de disparo
    signal movR: std_logic;
    signal movL: std_logic;
    signal resetShip: std_logic := '0';
    signal invencibilityTimer: natural range 0 to 240 := 0;
    signal randomNumber: integer range 0 to 1023;
    signal clkNumber: std_logic;

    signal X : natural range 0 to 1280; -- Pixel X de la salida del bloque VGA
    signal Y : natural range 0 to 1024; -- Pixel y de la salida del bloque VGA
    signal Red : natural range 0 to 15;
    signal Green : natural range 0 to 15;
    signal Blue : natural range 0 to 15;

    -- Constantes
    constant sizeOfGuy: natural := 50;
    constant centerX: natural := 640;
    constant centerY: natural := 512;

    -- Flag de game over
    signal gameOver: std_logic;

    -- BULLET
    constant sizeXBullet: natural := 6;
    constant sizeYBullet: natural := 20;
    signal posXBullet : natural range 0 to 1280;
    signal posYBullet : natural range 0 to 1024;
    signal hideBullet: std_logic := '1';
    signal clkBullet: std_logic;
    signal updatePosHide: std_logic := '0';
    signal updatePosCollision: std_logic := '0';
    signal updatePos: std_logic := '0';
    signal posXInBullet: natural range 0 to 1280;
    signal posXInBulletCollision: natural range 0 to 1280;

    -- INVADER
    signal clkInvader: std_logic;
    constant sizeInvader: natural := 50;
    type xInvaderArray is array (26 downto 0) of natural range 0 to 1280;
    type yInvaderArray is array (26 downto 0) of natural range 0 to 1024;
    signal posXInvader : xInvaderArray;
    signal posYInvader : yInvaderArray;
    signal hideInvader: std_logic_vector(26 downto 0) := "000000000000000000000000000";
    signal inverseInvader: std_logic := '0';
    signal collision: std_logic := '1';
    type invaderTimer is array (26 downto 0) of integer range 0 to 1023;
    signal invaderShootTimer: invaderTimer;
    
    type randomArray is array (26 downto 0) of integer range 0 to 1023;
    signal randomNumbers: randomArray;
    
    -- JOYSTICK
    signal x_position: STD_LOGIC_VECTOR(7 DOWNTO 0); -- Posición X del joystick
    signal y_position: STD_LOGIC_VECTOR(7 DOWNTO 0);
    
    -- Invader bullet
    signal hideBulletInvader: std_logic_vector(26 downto 0) := "111111111111111111111111111";
    signal bulletInvaderX: xInvaderArray;
    signal bulletInvaderY: yInvaderArray;
    signal posXInBulletInvader: xInvaderArray;
    signal posYInBulletInvader: yInvaderArray;
    
    -- Esta función nos permite dibujar caractéres en la pantalla
    -- Define cada caracter como una matriz de 1's y 0's
    -- Estos caracteres se guardan en memoria para ser utilizados posteriormente
    -- Función obtenida de https://github.com/alisemi/fpga-projects/blob/master/Don'tHitTheBars/game.vhd#L164
    function draw_char(X : natural; Y : natural; char : character) return boolean is
        constant ADDR_WIDTH: integer:=11;
        constant DATA_WIDTH: integer:=8;
        type rom_type is array (0 to 2**ADDR_WIDTH-1) of std_logic_vector(DATA_WIDTH-1 downto 0);
        -- ROM definition
        constant ROM: rom_type:=(   -- 2^11-by-8
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x01 ?
            "00000000", -- 0
            "00000000", -- 1
            "01111110", -- 2  ******
            "10000001", -- 3 *      *
            "10100101", -- 4 * *  * *
            "10000001", -- 5 *      *
            "10000001", -- 6 *      *
            "10111101", -- 7 * **** *
            "10011001", -- 8 *  **  *
            "10000001", -- 9 *      *
            "10000001", -- a *      *
            "01111110", -- b  ******
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x02 ?
            "00000000", -- 0
            "00000000", -- 1
            "01111110", -- 2  ******
            "11111111", -- 3 ********
            "11011011", -- 4 ** ** **
            "11111111", -- 5 ********
            "11111111", -- 6 ********
            "11000011", -- 7 **    **
            "11100111", -- 8 ***  ***
            "11111111", -- 9 ********
            "11111111", -- a ********
            "01111110", -- b  ******
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x03 ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "01101100", -- 4  ** **
            "11111110", -- 5 *******
            "11111110", -- 6 *******
            "11111110", -- 7 *******
            "11111110", -- 8 *******
            "01111100", -- 9  *****
            "00111000", -- a   ***
            "00010000", -- b    *
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x04 ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00010000", -- 4    *
            "00111000", -- 5   ***
            "01111100", -- 6  *****
            "11111110", -- 7 *******
            "01111100", -- 8  *****
            "00111000", -- 9   ***
            "00010000", -- a    *
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x05 ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00011000", -- 3    **
            "00111100", -- 4   ****
            "00111100", -- 5   ****
            "11100111", -- 6 ***  ***
            "11100111", -- 7 ***  ***
            "11100111", -- 8 ***  ***
            "00011000", -- 9    **
            "00011000", -- a    **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x06 ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00011000", -- 3    **
            "00111100", -- 4   ****
            "01111110", -- 5  ******
            "11111111", -- 6 ********
            "11111111", -- 7 ********
            "01111110", -- 8  ******
            "00011000", -- 9    **
            "00011000", -- a    **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x07 ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00011000", -- 6    **
            "00111100", -- 7   ****
            "00111100", -- 8   ****
            "00011000", -- 9    **
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x08 ?
            "11111111", -- 0 ********
            "11111111", -- 1 ********
            "11111111", -- 2 ********
            "11111111", -- 3 ********
            "11111111", -- 4 ********
            "11111111", -- 5 ********
            "11100111", -- 6 ***  ***
            "11000011", -- 7 **    **
            "11000011", -- 8 **    **
            "11100111", -- 9 ***  ***
            "11111111", -- a ********
            "11111111", -- b ********
            "11111111", -- c ********
            "11111111", -- d ********
            "11111111", -- e ********
            "11111111", -- f ********
            -- code x09 ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00111100", -- 5   ****
            "01100110", -- 6  **  **
            "01000010", -- 7  *    *
            "01000010", -- 8  *    *
            "01100110", -- 9  **  **
            "00111100", -- a   ****
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x0a ?
            "11111111", -- 0 ********
            "11111111", -- 1 ********
            "11111111", -- 2 ********
            "11111111", -- 3 ********
            "11111111", -- 4 ********
            "11000011", -- 5 **    **
            "10011001", -- 6 *  **  *
            "10111101", -- 7 * **** *
            "10111101", -- 8 * **** *
            "10011001", -- 9 *  **  *
            "11000011", -- a **    **
            "11111111", -- b ********
            "11111111", -- c ********
            "11111111", -- d ********
            "11111111", -- e ********
            "11111111", -- f ********
            -- code x0b ?
            "00000000", -- 0
            "00000000", -- 1
            "00011110", -- 2    ****
            "00001110", -- 3     ***
            "00011010", -- 4    ** *
            "00110010", -- 5   **  *
            "01111000", -- 6  ****
            "11001100", -- 7 **  **
            "11001100", -- 8 **  **
            "11001100", -- 9 **  **
            "11001100", -- a **  **
            "01111000", -- b  ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x0c ?
            "00000000", -- 0
            "00000000", -- 1
            "00111100", -- 2   ****
            "01100110", -- 3  **  **
            "01100110", -- 4  **  **
            "01100110", -- 5  **  **
            "01100110", -- 6  **  **
            "00111100", -- 7   ****
            "00011000", -- 8    **
            "01111110", -- 9  ******
            "00011000", -- a    **
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x0d ?
            "00000000", -- 0
            "00000000", -- 1
            "00111111", -- 2   ******
            "00110011", -- 3   **  **
            "00111111", -- 4   ******
            "00110000", -- 5   **
            "00110000", -- 6   **
            "00110000", -- 7   **
            "00110000", -- 8   **
            "01110000", -- 9  ***
            "11110000", -- a ****
            "11100000", -- b ***
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x0e ?
            "00000000", -- 0
            "00000000", -- 1
            "01111111", -- 2  *******
            "01100011", -- 3  **   **
            "01111111", -- 4  *******
            "01100011", -- 5  **   **
            "01100011", -- 6  **   **
            "01100011", -- 7  **   **
            "01100011", -- 8  **   **
            "01100111", -- 9  **  ***
            "11100111", -- a ***  ***
            "11100110", -- b ***  **
            "11000000", -- c **
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x0f ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00011000", -- 3    **
            "00011000", -- 4    **
            "11011011", -- 5 ** ** **
            "00111100", -- 6   ****
            "11100111", -- 7 ***  ***
            "00111100", -- 8   ****
            "11011011", -- 9 ** ** **
            "00011000", -- a    **
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x10 ?
            "00000000", -- 0
            "10000000", -- 1 *
            "11000000", -- 2 **
            "11100000", -- 3 ***
            "11110000", -- 4 ****
            "11111000", -- 5 *****
            "11111110", -- 6 *******
            "11111000", -- 7 *****
            "11110000", -- 8 ****
            "11100000", -- 9 ***
            "11000000", -- a **
            "10000000", -- b *
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x11 ?
            "00000000", -- 0
            "00000010", -- 1       *
            "00000110", -- 2      **
            "00001110", -- 3     ***
            "00011110", -- 4    ****
            "00111110", -- 5   *****
            "11111110", -- 6 *******
            "00111110", -- 7   *****
            "00011110", -- 8    ****
            "00001110", -- 9     ***
            "00000110", -- a      **
            "00000010", -- b       *
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x12 ?
            "00000000", -- 0
            "00000000", -- 1
            "00011000", -- 2    **
            "00111100", -- 3   ****
            "01111110", -- 4  ******
            "00011000", -- 5    **
            "00011000", -- 6    **
            "00011000", -- 7    **
            "01111110", -- 8  ******
            "00111100", -- 9   ****
            "00011000", -- a    **
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x13 ?
            "00000000", -- 0
            "00000000", -- 1
            "01100110", -- 2  **  **
            "01100110", -- 3  **  **
            "01100110", -- 4  **  **
            "01100110", -- 5  **  **
            "01100110", -- 6  **  **
            "01100110", -- 7  **  **
            "01100110", -- 8  **  **
            "00000000", -- 9
            "01100110", -- a  **  **
            "01100110", -- b  **  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x14 ?
            "00000000", -- 0
            "00000000", -- 1
            "01111111", -- 2  *******
            "11011011", -- 3 ** ** **
            "11011011", -- 4 ** ** **
            "11011011", -- 5 ** ** **
            "01111011", -- 6  **** **
            "00011011", -- 7    ** **
            "00011011", -- 8    ** **
            "00011011", -- 9    ** **
            "00011011", -- a    ** **
            "00011011", -- b    ** **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x15 ?
            "00000000", -- 0
            "01111100", -- 1  *****
            "11000110", -- 2 **   **
            "01100000", -- 3  **
            "00111000", -- 4   ***
            "01101100", -- 5  ** **
            "11000110", -- 6 **   **
            "11000110", -- 7 **   **
            "01101100", -- 8  ** **
            "00111000", -- 9   ***
            "00001100", -- a     **
            "11000110", -- b **   **
            "01111100", -- c  *****
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x16 ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "11111110", -- 8 *******
            "11111110", -- 9 *******
            "11111110", -- a *******
            "11111110", -- b *******
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x17 ?
            "00000000", -- 0
            "00000000", -- 1
            "00011000", -- 2    **
            "00111100", -- 3   ****
            "01111110", -- 4  ******
            "00011000", -- 5    **
            "00011000", -- 6    **
            "00011000", -- 7    **
            "01111110", -- 8  ******
            "00111100", -- 9   ****
            "00011000", -- a    **
            "01111110", -- b  ******
            "00110000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x18 ?
            "00000000", -- 0
            "00000000", -- 1
            "00011000", -- 2    **
            "00111100", -- 3   ****
            "01111110", -- 4  ******
            "00011000", -- 5    **
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x19 ?
            "00000000", -- 0
            "00000000", -- 1
            "00011000", -- 2    **
            "00011000", -- 3    **
            "00011000", -- 4    **
            "00011000", -- 5    **
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00011000", -- 8    **
            "01111110", -- 9  ******
            "00111100", -- a   ****
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x1a ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00011000", -- 5    **
            "00001100", -- 6     **
            "11111110", -- 7 *******
            "00001100", -- 8     **
            "00011000", -- 9    **
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x1b ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00110000", -- 5   **
            "01100000", -- 6  **
            "11111110", -- 7 *******
            "01100000", -- 8  **
            "00110000", -- 9   **
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x1c ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "11000000", -- 6 **
            "11000000", -- 7 **
            "11000000", -- 8 **
            "11111110", -- 9 *******
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x1d ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00100100", -- 5   *  *
            "01100110", -- 6  **  **
            "11111111", -- 7 ********
            "01100110", -- 8  **  **
            "00100100", -- 9   *  *
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x1e ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00010000", -- 4    *
            "00111000", -- 5   ***
            "00111000", -- 6   ***
            "01111100", -- 7  *****
            "01111100", -- 8  *****
            "11111110", -- 9 *******
            "11111110", -- a *******
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x1f ?
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "11111110", -- 4 *******
            "11111110", -- 5 *******
            "01111100", -- 6  *****
            "01111100", -- 7  *****
            "00111000", -- 8   ***
            "00111000", -- 9   ***
            "00010000", -- a    *
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x20 ' '
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x21 !
            "00000000", -- 0
            "00000000", -- 1
            "00011000", -- 2    **
            "00111100", -- 3   ****
            "00111100", -- 4   ****
            "00111100", -- 5   ****
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00000000", -- 9
            "00011000", -- a    **
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x22 "
            "00000000", -- 0
            "01100110", -- 1  **  **
            "01100110", -- 2  **  **
            "01100110", -- 3  **  **
            "00100100", -- 4   *  *
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x23 #
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "01101100", -- 3  ** **
            "01101100", -- 4  ** **
            "11111110", -- 5 *******
            "01101100", -- 6  ** **
            "01101100", -- 7  ** **
            "01101100", -- 8  ** **
            "11111110", -- 9 *******
            "01101100", -- a  ** **
            "01101100", -- b  ** **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x24 $
            "00011000", -- 0     **
            "00011000", -- 1     **
            "01111100", -- 2   *****
            "11000110", -- 3  **   **
            "11000010", -- 4  **    *
            "11000000", -- 5  **
            "01111100", -- 6   *****
            "00000110", -- 7       **
            "00000110", -- 8       **
            "10000110", -- 9  *    **
            "11000110", -- a  **   **
            "01111100", -- b   *****
            "00011000", -- c     **
            "00011000", -- d     **
            "00000000", -- e
            "00000000", -- f
            -- code x25 %
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "11000010", -- 4 **    *
            "11000110", -- 5 **   **
            "00001100", -- 6     **
            "00011000", -- 7    **
            "00110000", -- 8   **
            "01100000", -- 9  **
            "11000110", -- a **   **
            "10000110", -- b *    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x26 &
            "00000000", -- 0
            "00000000", -- 1
            "00111000", -- 2   ***
            "01101100", -- 3  ** **
            "01101100", -- 4  ** **
            "00111000", -- 5   ***
            "01110110", -- 6  *** **
            "11011100", -- 7 ** ***
            "11001100", -- 8 **  **
            "11001100", -- 9 **  **
            "11001100", -- a **  **
            "01110110", -- b  *** **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x27 '
            "00000000", -- 0
            "00110000", -- 1   **
            "00110000", -- 2   **
            "00110000", -- 3   **
            "01100000", -- 4  **
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x28 (
            "00000000", -- 0
            "00000000", -- 1
            "00001100", -- 2     **
            "00011000", -- 3    **
            "00110000", -- 4   **
            "00110000", -- 5   **
            "00110000", -- 6   **
            "00110000", -- 7   **
            "00110000", -- 8   **
            "00110000", -- 9   **
            "00011000", -- a    **
            "00001100", -- b     **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x29 )
            "00000000", -- 0
            "00000000", -- 1
            "00110000", -- 2   **
            "00011000", -- 3    **
            "00001100", -- 4     **
            "00001100", -- 5     **
            "00001100", -- 6     **
            "00001100", -- 7     **
            "00001100", -- 8     **
            "00001100", -- 9     **
            "00011000", -- a    **
            "00110000", -- b   **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x2a *
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01100110", -- 5  **  **
            "00111100", -- 6   ****
            "11111111", -- 7 ********
            "00111100", -- 8   ****
            "01100110", -- 9  **  **
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x2b +
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00011000", -- 5    **
            "00011000", -- 6    **
            "01111110", -- 7  ******
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x2c ,
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00011000", -- 9    **
            "00011000", -- a    **
            "00011000", -- b    **
            "00110000", -- c   **
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x2d -
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "01111110", -- 7  ******
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x2e  .
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00011000", -- a    **
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x2f /
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000010", -- 4       *
            "00000110", -- 5      **
            "00001100", -- 6     **
            "00011000", -- 7    **
            "00110000", -- 8   **
            "01100000", -- 9  **
            "11000000", -- a **
            "10000000", -- b *
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x30
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "11001110", -- 5 **  ***
            "11011110", -- 6 ** ****
            "11110110", -- 7 **** **
            "11100110", -- 8 ***  **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x31 
            "00000000", -- 0
            "00000000", -- 1
            "00011000", -- 2
            "00111000", -- 3
            "01111000", -- 4    **
            "00011000", -- 5   ***
            "00011000", -- 6  ****
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "01111110", -- b    **
            "00000000", -- c    **
            "00000000", -- d  ******
            "00000000", -- e
            "00000000", -- f
            -- code x32
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "00000110", -- 4      **
            "00001100", -- 5     **
            "00011000", -- 6    **
            "00110000", -- 7   **
            "01100000", -- 8  **
            "11000000", -- 9 **
            "11000110", -- a **   **
            "11111110", -- b *******
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x33
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "00000110", -- 4      **
            "00000110", -- 5      **
            "00111100", -- 6   ****
            "00000110", -- 7      **
            "00000110", -- 8      **
            "00000110", -- 9      **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x34
            "00000000", -- 0
            "00000000", -- 1
            "00001100", -- 2     **
            "00011100", -- 3    ***
            "00111100", -- 4   ****
            "01101100", -- 5  ** **
            "11001100", -- 6 **  **
            "11111110", -- 7 *******
            "00001100", -- 8     **
            "00001100", -- 9     **
            "00001100", -- a     **
            "00011110", -- b    ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x35
            "00000000", -- 0
            "00000000", -- 1
            "11111110", -- 2 *******
            "11000000", -- 3 **
            "11000000", -- 4 **
            "11000000", -- 5 **
            "11111100", -- 6 ******
            "00000110", -- 7      **
            "00000110", -- 8      **
            "00000110", -- 9      **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x36
            "00000000", -- 0
            "00000000", -- 1
            "00111000", -- 2   ***
            "01100000", -- 3  **
            "11000000", -- 4 **
            "11000000", -- 5 **
            "11111100", -- 6 ******
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x37
            "00000000", -- 0
            "00000000", -- 1
            "11111110", -- 2 *******
            "11000110", -- 3 **   **
            "00000110", -- 4      **
            "00000110", -- 5      **
            "00001100", -- 6     **
            "00011000", -- 7    **
            "00110000", -- 8   **
            "00110000", -- 9   **
            "00110000", -- a   **
            "00110000", -- b   **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x38
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "11000110", -- 5 **   **
            "01111100", -- 6  *****
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x39
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "11000110", -- 5 **   **
            "01111110", -- 6  ******
            "00000110", -- 7      **
            "00000110", -- 8      **
            "00000110", -- 9      **
            "00001100", -- a     **
            "01111000", -- b  ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x3a :
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00011000", -- 4    **
            "00011000", -- 5    **
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00011000", -- 9    **
            "00011000", -- a    **
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x3b ;
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00011000", -- 4    **
            "00011000", -- 5    **
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00011000", -- 9    **
            "00011000", -- a    **
            "00110000", -- b   **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x3c <
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000110", -- 3      **
            "00001100", -- 4     **
            "00011000", -- 5    **
            "00110000", -- 6   **
            "01100000", -- 7  **
            "00110000", -- 8   **
            "00011000", -- 9    **
            "00001100", -- a     **
            "00000110", -- b      **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x3d =
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01111110", -- 5  ******
            "00000000", -- 6
            "00000000", -- 7
            "01111110", -- 8  ******
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x3e >
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "01100000", -- 3  **
            "00110000", -- 4   **
            "00011000", -- 5    **
            "00001100", -- 6     **
            "00000110", -- 7      **
            "00001100", -- 8     **
            "00011000", -- 9    **
            "00110000", -- a   **
            "01100000", -- b  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x3f ?
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "00001100", -- 5     **
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00000000", -- 9
            "00011000", -- a    **
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            --------------------------------------------------
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "01101100", -- 4  ** **
            "11111110", -- 5 *******
            "11111110", -- 6 *******
            "11111110", -- 7 *******
            "11111110", -- 8 *******
            "01111100", -- 9  *****
            "00111000", -- a   ***
            "00010000", -- b    *
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            --            -- code x40 @
            --            "00000000", -- 0
            --            "00000000", -- 1
            --            "01111100", -- 2  *****
            --            "11000110", -- 3 **   **
            --            "11000110", -- 4 **   **
            --            "11000110", -- 5 **   **
            --            "11011110", -- 6 ** ****
            --            "11011110", -- 7 ** ****
            --            "11011110", -- 8 ** ****
            --            "11011100", -- 9 ** ***
            --            "11000000", -- a **
            --            "01111100", -- b  *****
            --            "00000000", -- c
            --            "00000000", -- d
            --            "00000000", -- e
            --            "00000000", -- f
            --------------------------------------------------
            -- code x41
            "00000000", -- 0
            "00000000", -- 1
            "00010000", -- 2    *
            "00111000", -- 3   ***
            "01101100", -- 4  ** **
            "11000110", -- 5 **   **
            "11000110", -- 6 **   **
            "11111110", -- 7 *******
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "11000110", -- b **   **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x42
            "00000000", -- 0
            "00000000", -- 1
            "11111100", -- 2 ******
            "01100110", -- 3  **  **
            "01100110", -- 4  **  **
            "01100110", -- 5  **  **
            "01111100", -- 6  *****
            "01100110", -- 7  **  **
            "01100110", -- 8  **  **
            "01100110", -- 9  **  **
            "01100110", -- a  **  **
            "11111100", -- b ******
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x43
            "00000000", -- 0
            "00000000", -- 1
            "00111100", -- 2   ****
            "01100110", -- 3  **  **
            "11000010", -- 4 **    *
            "11000000", -- 5 **
            "11000000", -- 6 **
            "11000000", -- 7 **
            "11000000", -- 8 **
            "11000010", -- 9 **    *
            "01100110", -- a  **  **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x44
            "00000000", -- 0
            "00000000", -- 1
            "11111000", -- 2 *****
            "01101100", -- 3  ** **
            "01100110", -- 4  **  **
            "01100110", -- 5  **  **
            "01100110", -- 6  **  **
            "01100110", -- 7  **  **
            "01100110", -- 8  **  **
            "01100110", -- 9  **  **
            "01101100", -- a  ** **
            "11111000", -- b *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x45
            "00000000", -- 0
            "00000000", -- 1
            "11111110", -- 2 *******
            "01100110", -- 3  **  **
            "01100010", -- 4  **   *
            "01101000", -- 5  ** *
            "01111000", -- 6  ****
            "01101000", -- 7  ** *
            "01100000", -- 8  **
            "01100010", -- 9  **   *
            "01100110", -- a  **  **
            "11111110", -- b *******
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x46
            "00000000", -- 0
            "00000000", -- 1
            "11111110", -- 2 *******
            "01100110", -- 3  **  **
            "01100010", -- 4  **   *
            "01101000", -- 5  ** *
            "01111000", -- 6  ****
            "01101000", -- 7  ** *
            "01100000", -- 8  **
            "01100000", -- 9  **
            "01100000", -- a  **
            "11110000", -- b ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x47
            "00000000", -- 0
            "00000000", -- 1
            "00111100", -- 2   ****
            "01100110", -- 3  **  **
            "11000010", -- 4 **    *
            "11000000", -- 5 **
            "11000000", -- 6 **
            "11011110", -- 7 ** ****
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "01100110", -- a  **  **
            "00111010", -- b   *** *
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x48
            "00000000", -- 0
            "00000000", -- 1
            "11000110", -- 2 **   **
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "11000110", -- 5 **   **
            "11111110", -- 6 *******
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "11000110", -- b **   **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x49
            "00000000", -- 0
            "00000000", -- 1
            "00111100", -- 2   ****
            "00011000", -- 3    **
            "00011000", -- 4    **
            "00011000", -- 5    **
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x4a
            "00000000", -- 0
            "00000000", -- 1
            "00011110", -- 2    ****
            "00001100", -- 3     **
            "00001100", -- 4     **
            "00001100", -- 5     **
            "00001100", -- 6     **
            "00001100", -- 7     **
            "11001100", -- 8 **  **
            "11001100", -- 9 **  **
            "11001100", -- a **  **
            "01111000", -- b  ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x4b
            "00000000", -- 0
            "00000000", -- 1
            "11100110", -- 2 ***  **
            "01100110", -- 3  **  **
            "01100110", -- 4  **  **
            "01101100", -- 5  ** **
            "01111000", -- 6  ****
            "01111000", -- 7  ****
            "01101100", -- 8  ** **
            "01100110", -- 9  **  **
            "01100110", -- a  **  **
            "11100110", -- b ***  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x4c
            "00000000", -- 0
            "00000000", -- 1
            "11110000", -- 2 ****
            "01100000", -- 3  **
            "01100000", -- 4  **
            "01100000", -- 5  **
            "01100000", -- 6  **
            "01100000", -- 7  **
            "01100000", -- 8  **
            "01100010", -- 9  **   *
            "01100110", -- a  **  **
            "11111110", -- b *******
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x4d
            "00000000", -- 0
            "00000000", -- 1
            "11000011", -- 2 **    **
            "11100111", -- 3 ***  ***
            "11111111", -- 4 ********
            "11111111", -- 5 ********
            "11011011", -- 6 ** ** **
            "11000011", -- 7 **    **
            "11000011", -- 8 **    **
            "11000011", -- 9 **    **
            "11000011", -- a **    **
            "11000011", -- b **    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x4e
            "00000000", -- 0
            "00000000", -- 1
            "11000110", -- 2 **   **
            "11100110", -- 3 ***  **
            "11110110", -- 4 **** **
            "11111110", -- 5 *******
            "11011110", -- 6 ** ****
            "11001110", -- 7 **  ***
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "11000110", -- b **   **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x4f
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "11000110", -- 5 **   **
            "11000110", -- 6 **   **
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x50
            "00000000", -- 0
            "00000000", -- 1
            "11111100", -- 2 ******
            "01100110", -- 3  **  **
            "01100110", -- 4  **  **
            "01100110", -- 5  **  **
            "01111100", -- 6  *****
            "01100000", -- 7  **
            "01100000", -- 8  **
            "01100000", -- 9  **
            "01100000", -- a  **
            "11110000", -- b ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x510
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "11000110", -- 5 **   **
            "11000110", -- 6 **   **
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11010110", -- 9 ** * **
            "11011110", -- a ** ****
            "01111100", -- b  *****
            "00001100", -- c     **
            "00001110", -- d     ***
            "00000000", -- e
            "00000000", -- f
            -- code x52
            "00000000", -- 0
            "00000000", -- 1
            "11111100", -- 2 ******
            "01100110", -- 3  **  **
            "01100110", -- 4  **  **
            "01100110", -- 5  **  **
            "01111100", -- 6  *****
            "01101100", -- 7  ** **
            "01100110", -- 8  **  **
            "01100110", -- 9  **  **
            "01100110", -- a  **  **
            "11100110", -- b ***  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x53
            "00000000", -- 0
            "00000000", -- 1
            "01111100", -- 2  *****
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "01100000", -- 5  **
            "00111000", -- 6   ***
            "00001100", -- 7     **
            "00000110", -- 8      **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x54
            "00000000", -- 0
            "00000000", -- 1
            "11111111", -- 2 ********
            "11011011", -- 3 ** ** **
            "10011001", -- 4 *  **  *
            "00011000", -- 5    **
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x55
            "00000000", -- 0
            "00000000", -- 1
            "11000110", -- 2 **   **
            "11000110", -- 3 **   **
            "11000110", -- 4 **   **
            "11000110", -- 5 **   **
            "11000110", -- 6 **   **
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x56
            "00000000", -- 0
            "00000000", -- 1
            "11000011", -- 2 **    **
            "11000011", -- 3 **    **
            "11000011", -- 4 **    **
            "11000011", -- 5 **    **
            "11000011", -- 6 **    **
            "11000011", -- 7 **    **
            "11000011", -- 8 **    **
            "01100110", -- 9  **  **
            "00111100", -- a   ****
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x57
            "00000000", -- 0
            "00000000", -- 1
            "11000011", -- 2 **    **
            "11000011", -- 3 **    **
            "11000011", -- 4 **    **
            "11000011", -- 5 **    **
            "11000011", -- 6 **    **
            "11011011", -- 7 ** ** **
            "11011011", -- 8 ** ** **
            "11111111", -- 9 ********
            "01100110", -- a  **  **
            "01100110", -- b  **  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f

            -- code x58
            "00000000", -- 0
            "00000000", -- 1
            "11000011", -- 2 **    **
            "11000011", -- 3 **    **
            "01100110", -- 4  **  **
            "00111100", -- 5   ****
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00111100", -- 8   ****
            "01100110", -- 9  **  **
            "11000011", -- a **    **
            "11000011", -- b **    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x59
            "00000000", -- 0
            "00000000", -- 1
            "11000011", -- 2 **    **
            "11000011", -- 3 **    **
            "11000011", -- 4 **    **
            "01100110", -- 5  **  **
            "00111100", -- 6   ****
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x5a
            "00000000", -- 0
            "00000000", -- 1
            "11111111", -- 2 ********
            "11000011", -- 3 **    **
            "10000110", -- 4 *    **
            "00001100", -- 5     **
            "00011000", -- 6    **
            "00110000", -- 7   **
            "01100000", -- 8  **
            "11000001", -- 9 **     *
            "11000011", -- a **    **
            "11111111", -- b ********
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x5b
            "00000000", -- 0
            "00000000", -- 1
            "00111100", -- 2   ****
            "00110000", -- 3   **
            "00110000", -- 4   **
            "00110000", -- 5   **
            "00110000", -- 6   **
            "00110000", -- 7   **
            "00110000", -- 8   **
            "00110000", -- 9   **
            "00110000", -- a   **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x5c
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "10000000", -- 3 *
            "11000000", -- 4 **
            "11100000", -- 5 ***
            "01110000", -- 6  ***
            "00111000", -- 7   ***
            "00011100", -- 8    ***
            "00001110", -- 9     ***
            "00000110", -- a      **
            "00000010", -- b       *
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x5d
            "00000000", -- 0
            "00000000", -- 1
            "00111100", -- 2   ****
            "00001100", -- 3     **
            "00001100", -- 4     **
            "00001100", -- 5     **
            "00001100", -- 6     **
            "00001100", -- 7     **
            "00001100", -- 8     **
            "00001100", -- 9     **
            "00001100", -- a     **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x5e
            "00010000", -- 0    *
            "00111000", -- 1   ***
            "01101100", -- 2  ** **
            "11000110", -- 3 **   **
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x5f
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "11111111", -- d ********
            "00000000", -- e
            "00000000", -- f
            -- code x60
            "00110000", -- 0   **
            "00110000", -- 1   **
            "00011000", -- 2    **
            "00000000", -- 3
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x61
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01111000", -- 5  ****
            "00001100", -- 6     **
            "01111100", -- 7  *****
            "11001100", -- 8 **  **
            "11001100", -- 9 **  **
            "11001100", -- a **  **
            "01110110", -- b  *** **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x62
            "00000000", -- 0
            "00000000", -- 1
            "11100000", -- 2  ***
            "01100000", -- 3   **
            "01100000", -- 4   **
            "01111000", -- 5   ****
            "01101100", -- 6   ** **
            "01100110", -- 7   **  **
            "01100110", -- 8   **  **
            "01100110", -- 9   **  **
            "01100110", -- a   **  **
            "01111100", -- b   *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x63
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01111100", -- 5  *****
            "11000110", -- 6 **   **
            "11000000", -- 7 **
            "11000000", -- 8 **
            "11000000", -- 9 **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x64
            "00000000", -- 0
            "00000000", -- 1
            "00011100", -- 2    ***
            "00001100", -- 3     **
            "00001100", -- 4     **
            "00111100", -- 5   ****
            "01101100", -- 6  ** **
            "11001100", -- 7 **  **
            "11001100", -- 8 **  **
            "11001100", -- 9 **  **
            "11001100", -- a **  **
            "01110110", -- b  *** **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x65
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01111100", -- 5  *****
            "11000110", -- 6 **   **
            "11111110", -- 7 *******
            "11000000", -- 8 **
            "11000000", -- 9 **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x66
            "00000000", -- 0
            "00000000", -- 1
            "00111000", -- 2   ***
            "01101100", -- 3  ** **
            "01100100", -- 4  **  *
            "01100000", -- 5  **
            "11110000", -- 6 ****
            "01100000", -- 7  **
            "01100000", -- 8  **
            "01100000", -- 9  **
            "01100000", -- a  **
            "11110000", -- b ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x67
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01110110", -- 5  *** **
            "11001100", -- 6 **  **
            "11001100", -- 7 **  **
            "11001100", -- 8 **  **
            "11001100", -- 9 **  **
            "11001100", -- a **  **
            "01111100", -- b  *****
            "00001100", -- c     **
            "11001100", -- d **  **
            "01111000", -- e  ****
            "00000000", -- f
            -- code x68
            "00000000", -- 0
            "00000000", -- 1
            "11100000", -- 2 ***
            "01100000", -- 3  **
            "01100000", -- 4  **
            "01101100", -- 5  ** **
            "01110110", -- 6  *** **
            "01100110", -- 7  **  **
            "01100110", -- 8  **  **
            "01100110", -- 9  **  **
            "01100110", -- a  **  **
            "11100110", -- b ***  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x69
            "00000000", -- 0
            "00000000", -- 1
            "00011000", -- 2    **
            "00011000", -- 3    **
            "00000000", -- 4
            "00111000", -- 5   ***
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x6a
            "00000000", -- 0
            "00000000", -- 1
            "00000110", -- 2      **
            "00000110", -- 3      **
            "00000000", -- 4
            "00001110", -- 5     ***
            "00000110", -- 6      **
            "00000110", -- 7      **
            "00000110", -- 8      **
            "00000110", -- 9      **
            "00000110", -- a      **
            "00000110", -- b      **
            "01100110", -- c  **  **
            "01100110", -- d  **  **
            "00111100", -- e   ****
            "00000000", -- f
            -- code x6b
            "00000000", -- 0
            "00000000", -- 1
            "11100000", -- 2 ***
            "01100000", -- 3  **
            "01100000", -- 4  **
            "01100110", -- 5  **  **
            "01101100", -- 6  ** **
            "01111000", -- 7  ****
            "01111000", -- 8  ****
            "01101100", -- 9  ** **
            "01100110", -- a  **  **
            "11100110", -- b ***  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x6c
            "00000000", -- 0
            "00000000", -- 1
            "00111000", -- 2   ***
            "00011000", -- 3    **
            "00011000", -- 4    **
            "00011000", -- 5    **
            "00011000", -- 6    **
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "00111100", -- b   ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x6d
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11100110", -- 5 ***  **
            "11111111", -- 6 ********
            "11011011", -- 7 ** ** **
            "11011011", -- 8 ** ** **
            "11011011", -- 9 ** ** **
            "11011011", -- a ** ** **
            "11011011", -- b ** ** **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x6e
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11011100", -- 5 ** ***
            "01100110", -- 6  **  **
            "01100110", -- 7  **  **
            "01100110", -- 8  **  **
            "01100110", -- 9  **  **
            "01100110", -- a  **  **
            "01100110", -- b  **  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x6f
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01111100", -- 5  *****
            "11000110", -- 6 **   **
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x70
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11011100", -- 5 ** ***
            "01100110", -- 6  **  **
            "01100110", -- 7  **  **
            "01100110", -- 8  **  **
            "01100110", -- 9  **  **
            "01100110", -- a  **  **
            "01111100", -- b  *****
            "01100000", -- c  **
            "01100000", -- d  **
            "11110000", -- e ****
            "00000000", -- f
            -- code x71
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01110110", -- 5  *** **
            "11001100", -- 6 **  **
            "11001100", -- 7 **  **
            "11001100", -- 8 **  **
            "11001100", -- 9 **  **
            "11001100", -- a **  **
            "01111100", -- b  *****
            "00001100", -- c     **
            "00001100", -- d     **
            "00011110", -- e    ****
            "00000000", -- f
            -- code x72
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11011100", -- 5 ** ***
            "01110110", -- 6  *** **
            "01100110", -- 7  **  **
            "01100000", -- 8  **
            "01100000", -- 9  **
            "01100000", -- a  **
            "11110000", -- b ****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x73
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "01111100", -- 5  *****
            "11000110", -- 6 **   **
            "01100000", -- 7  **
            "00111000", -- 8   ***
            "00001100", -- 9     **
            "11000110", -- a **   **
            "01111100", -- b  *****
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x74
            "00000000", -- 0
            "00000000", -- 1
            "00010000", -- 2    *
            "00110000", -- 3   **
            "00110000", -- 4   **
            "11111100", -- 5 ******
            "00110000", -- 6   **
            "00110000", -- 7   **
            "00110000", -- 8   **
            "00110000", -- 9   **
            "00110110", -- a   ** **
            "00011100", -- b    ***
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x75
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11001100", -- 5 **  **
            "11001100", -- 6 **  **
            "11001100", -- 7 **  **
            "11001100", -- 8 **  **
            "11001100", -- 9 **  **
            "11001100", -- a **  **
            "01110110", -- b  *** **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x76
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11000011", -- 5 **    **
            "11000011", -- 6 **    **
            "11000011", -- 7 **    **
            "11000011", -- 8 **    **
            "01100110", -- 9  **  **
            "00111100", -- a   ****
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x77
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11000011", -- 5 **    **
            "11000011", -- 6 **    **
            "11000011", -- 7 **    **
            "11011011", -- 8 ** ** **
            "11011011", -- 9 ** ** **
            "11111111", -- a ********
            "01100110", -- b  **  **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x78
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11000011", -- 5 **    **
            "01100110", -- 6  **  **
            "00111100", -- 7   ****
            "00011000", -- 8    **
            "00111100", -- 9   ****
            "01100110", -- a  **  **
            "11000011", -- b **    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x79
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11000110", -- 5 **   **
            "11000110", -- 6 **   **
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11000110", -- a **   **
            "01111110", -- b  ******
            "00000110", -- c      **
            "00001100", -- d     **
            "11111000", -- e *****
            "00000000", -- f
            -- code x7a
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00000000", -- 4
            "11111110", -- 5 *******
            "11001100", -- 6 **  **
            "00011000", -- 7    **
            "00110000", -- 8   **
            "01100000", -- 9  **
            "11000110", -- a **   **
            "11111110", -- b *******
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x7b {
            "00000000", -- 0
            "00000000", -- 1
            "00001110", -- 2     ***
            "00011000", -- 3    **
            "00011000", -- 4    **
            "00011000", -- 5    **
            "01110000", -- 6  ***
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "00001110", -- b     ***
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x7c |
            "00000000", -- 0
            "00000000", -- 1
            "00011000", -- 2    **
            "00011000", -- 3    **
            "00011000", -- 4    **
            "00011000", -- 5    **
            "00000000", -- 6
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "00011000", -- b    **
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x7d }
            "00000000", -- 0
            "00000000", -- 1
            "01110000", -- 2  ***
            "00011000", -- 3    **
            "00011000", -- 4    **
            "00011000", -- 5    **
            "00001110", -- 6     ***
            "00011000", -- 7    **
            "00011000", -- 8    **
            "00011000", -- 9    **
            "00011000", -- a    **
            "01110000", -- b  ***
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x7e ~
            "00000000", -- 0
            "00000000", -- 1
            "01110110", -- 2  *** **
            "11011100", -- 3 ** ***
            "00000000", -- 4
            "00000000", -- 5
            "00000000", -- 6
            "00000000", -- 7
            "00000000", -- 8
            "00000000", -- 9
            "00000000", -- a
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000", -- f
            -- code x7f
            "00000000", -- 0
            "00000000", -- 1
            "00000000", -- 2
            "00000000", -- 3
            "00010000", -- 4    *
            "00111000", -- 5   ***
            "01101100", -- 6  ** **
            "11000110", -- 7 **   **
            "11000110", -- 8 **   **
            "11000110", -- 9 **   **
            "11111110", -- a *******
            "00000000", -- b
            "00000000", -- c
            "00000000", -- d
            "00000000", -- e
            "00000000"  -- f
        );
    begin
        --return X <= 8 and Y <= 16 and ROM((char * 16) + Y)(9 - X) = '1';
        return ROM((CHARACTER'POS(char) * 16) + Y)(9 - X) = '1';
    end draw_char;

    function draw_string(scanX : natural; scanY : natural; posX : natural; posY : natural; s : string; center : boolean; size : natural) return boolean is
        constant charW : natural := 8 * size;
        constant charWsp : natural := charW + 2;
        constant charH : natural := 16 * size;
        constant width : natural := charWsp * s'LENGTH;
        constant height : natural := charH;
        variable x : natural := posX;
        variable y : natural := posY;
        variable char : natural;
        variable subX : natural;
    begin
        if (center) then
            x := x - (width / 2);
            y := y - (height / 2);
        end if;

        if (scanX < x or scanY < y) then
            return false;
        end if;

        if (scanX - x > width or scanY - y > height) then
            return false;
        end if;

        x := scanX - x;
        y := scanY - y;

        subX := x mod charWsp;
        char := (x / charWsp) + 1;

        return draw_char(subX / size, y / size, s(char));
    end draw_string;
begin
    -- Declaración de todas las entidades
    VGA: entity work.vga
        port map (
            CLK_I => clk,
            VGA_RED_O => vgaRed,
            VGA_BLUE_O => vgaBlue,
            VGA_GREEN_O => vgaGreen,
            VGA_HS_O => Hsync,
            VGA_VS_O => Vsync,
            X => X,
            Y => Y,
            R => Red,
            G => Green,
            B => Blue
        );
        
    JOYSTICK: entity work.pmod_joystick
                        port map ( clk            => clk,
                                   reset_n        => not reset,
                                   miso           => miso,
                                   mosi           => mosi,
                                   sclk           => sclk,
                                   cs_n           => cs_n,
                                   x_position     => x_position,
                                   y_position     => y_position,
                                   trigger_button => shoot,
                                   center_button  => open );
    SHIP: entity work.ship
        port map (
            mvR => movR,-- Movimiento derecha
            mvL => movL,-- Movimiento izquierda
            rst => reset or resetShip,
            clk => clkShip,
            X => posX,
            Y => posY
        );

    GAMECLOCK: entity work.gameClock
        port map(
            clk => clk,
            clkShip => clkShip,
            clkBullet => clkBullet,
            clkInvader => clkInvader,
            clkNumber => clkNumber
        );
        
    LFG: entity work.LFG
        port map(
            clk => clkNumber,
            number => randomNumber
        );

    BULLET: entity work.bullet
        port map(
            clk => clkBullet ,
            hide => hideBullet or collision ,
            xIn => posXInBullet,
            yIn => posY,
            xOut => posXBullet,
            yOut => posYBullet
        );

    -- 27 INVADERS: 3 ROWS x 9 COLUMNS
    INVADERS: for i in 0 to 26 generate
        INVADER_i: entity work.invader
            port map(
                clk => clkInvader,
                rst => reset,
                xIn => centerX - ((80 * 9) / 2) + 80 * (i mod 9),
                yIn => 70 + (80 * (i / 9)),
                xOut => posXInvader(i),
                yOut => posYInvader(i),
                inverse => inverseInvader
            );
    end generate;
    
    -- 27 INVADERS: 3 ROWS x 9 COLUMNS
    INVADERBULLETS: for i in 0 to 26 generate
        INVADERBULLET: entity work.invaderBullet 
            port map(
                clk => clkBullet,
                hide => hideBulletInvader (i),
                xIn => posXInBulletInvader(i) + (sizeInvader / 2),
                yIn => posYInBulletInvader(i) + sizeInvader,
                xOut => bulletInvaderX(i),
                yOut => bulletInvaderY(i)
                
            );
    end generate;

    updatePos <= updatePosCollision or updatePosHide;
    --x_position es un número de 8 bits, para calcular el movimiento hemos hecho lo siguiente
    movR <= x_position(7) and x_position(6);                                --11XXXXXX bits
    movL <= not x_position(7) and not x_position(6) and not x_position(5);  --000XXXXX bits
    
    -- Initial bullet array
    -- Para cada bala le damos un número aleatorio inicial(10 bits) que es el número de ticks que tiene que esperar para realizar el primer disparo
    randomNumbers(0) <= 897;
    randomNumbers(1) <= 476;
    randomNumbers(2) <= 62;
    randomNumbers(3) <= 543;
    randomNumbers(4) <= 712;
    randomNumbers(5) <= 103;
    randomNumbers(6) <= 948;
    randomNumbers(7) <= 268;
    randomNumbers(8) <= 403;
    randomNumbers(9) <= 717;
    randomNumbers(10) <= 834;
    randomNumbers(11) <= 158;
    randomNumbers(12) <= 628;
    randomNumbers(13) <= 821;
    randomNumbers(14) <= 486;
    randomNumbers(15) <= 212;
    randomNumbers(16) <= 740;
    randomNumbers(17) <= 39;
    randomNumbers(18) <= 972;
    randomNumbers(19) <= 506;
    randomNumbers(20) <= 285;
    randomNumbers(21) <= 431;
    randomNumbers(22) <= 62;
    randomNumbers(23) <= 776;
    randomNumbers(24) <= 956;
    randomNumbers(25) <= 115;
    randomNumbers(26) <= 487;


    -- Bullet update X pos
    -- Cada vez que updatePos es 1 entonces actualizamos la posición X de la bala del jugador a la posición del jugador
    updatePosP: process(updatePosHide, updatePosCollision)
    begin
        if(updatePos = '1') then
            posXInBullet <= posX + (sizeOfGuy / 2);
        end if;
    end process;

    -- Shoot process
    shootP: process(shoot, hideBullet)
    begin
        if(rising_edge(clkBullet)) then
            -- Si pulsamos el botón de disparar y la bala está escondida entonces actualizamos la posición de la bala y dejamos que se vea
            -- Al poner hideBullet a 0 hará que la bala empiece a moverse hacia arriba automáticamente(ver bullet.vhd:25L)
            if(shoot = '1' and hideBullet = '1') then
                hideBullet <= '0';
                updatePosHide <= '1';
            else
                updatePosHide <= '0';
            end if;
            -- Si la bala llega arriba de la pantalla o activamos el switch del reset escondemos la bala
            if(posYBullet <= 70 or reset = '1') then
                hideBullet <= '1';
            end if;
        end if;
    end process;
    
    -- Shoot process
    shootInvaderP: process(lives, resetShip, hideInvader)
    begin
        if(rising_edge(clkBullet)) then
            -- Reset
            if(reset = '1')then
                lives <= 3;
                resetShip <= '0';
                invencibilityTimer <= 0;
                hideBulletInvader <= "111111111111111111111111111"; -- Ocultamos todas las balas
                for i in 0 to 26 loop
                    invaderShootTimer(i) <= randomNumbers(i); -- Ponemos el valor inicial de números aleatorios en el tiempo de espera de disparo de cada invasor
                    posXInBulletInvader(i) <= posXInvader(i); -- Actualizamos la bala a la posición de cada invasor
                    posYInBulletInvader(i) <= posYInvader(i);
                end loop;
            end if;
            -- 
            if(resetShip = '1') then
                resetShip <= '0';
            end if;
            -- Decrementa el contador de tiempo de invencibilidad
            if(invencibilityTimer > 0) then 
                invencibilityTimer <= invencibilityTimer - 1;
            end if;
            -- Por cada i invasor:
            for i in 0 to 26 loop
                -- Si invaderShootTimer(i) es mayor que 0 y la bala correspondiente a ese invasor está escondida entonces decrementamos el contador
                -- que es el tiempo que tiene que esperar hasta realizar el siguiente disparo
                if(invaderShootTimer(i) > 0 and hideBulletInvader(i) = '1' and reset = '0') then
                    invaderShootTimer(i) <= invaderShootTimer(i) - 1;
                end if;
                -- Si el contador invaderShootTimer(i) es 0 y la bala está escondida y el invasor no está muerto entonces disparamos
                if(invaderShootTimer(i) = 0 and hideBulletInvader(i) = '1' and hideInvader(i) = '0' and reset = '0'-- and canShootInvader(i) = '1'
                ) then
                    invaderShootTimer(i) <= randomNumber; -- Asignamos un valor aleatorio para realizar el próximo disparo
                    hideBulletInvader(i) <= '0'; --La bala del invasor para a ser visible
                    posXInBulletInvader(i) <= posXInvader(i); -- Actualizamos la posición de la bala a la del invasor
                    posYInBulletInvader(i) <= posYInvader(i);
                end if;
                -- Si la bala del invasor llega abajo de la pantalla entonces la escondemos
                if(bulletInvaderY(i) >= 970 or reset = '1') then
                    hideBulletInvader(i) <= '1';
                    --canShootInvader(i) <= '1';
                end if;
                -- COLISIÓN CON EL PERSONAJE
                -- Si la bala del invasor i está visible y está dentro del área de la nave entonces...
                if(hideBulletInvader(i) = '0' and
 bulletInvaderX(i) >= posX and
 bulletInvaderX(i) <= posX + sizeOfGuy and
 bulletInvaderY(i) >= posY and
 bulletInvaderY(i) <= posY + sizeOfGuy and
 invencibilityTimer = 0
) then
                    -- Restamos una vida
                    if(lives > 0) then
                        lives <= lives -1;
                    end if;
                    resetShip <= '1'; -- Reseteamos la nave para que vuelva a la posición inicial
                    invencibilityTimer <= 240; -- Actualizamos el contador de invencibilidad
                    end if;
                
            end loop;
            
        end if;
    end process;

    -- Invader movement
    invaderMovementP: process(posXInvader, clkInvader, collision, shoot)
    begin
        if(rising_edge(clkInvader)) then
            if(collision = '1' and shoot = '1') then
                collision <= '0';
                updatePosCollision <= '1';
            else
                updatePosCollision <= '0';
            end if;
            -- Por cada i invasor...
            for i in 0 to 26 loop
                -- Si hay reset hacemos visible al invasor
                if(reset = '1') then
                    hideInvader (i) <= '0';
                end if;
                -- Si el invasor llega a la derecha de la pantalla entonces invertimos el movimiento(ver invader.vhd:31L)
                if(posXInvader(i) = 1280 - sizeInvader and inverseInvader = '0' and hideInvader(i) = '0') then
                    inverseInvader <= '1';
                    exit;
                end if;
                -- Si el invasor llega a la izquierda de la pantalla entonces invertimos el movimiento(ver invader.vhd:34L)
                if(posXInvader(i) = 0 and inverseInvader = '1' and hideInvader(i) = '0') then
                    inverseInvader <= '0';
                    exit;
                end if;
                -- Bullet collision
                -- Si el invasor está visible y la bala de la nave está en su área...
                if(hideInvader (i) = '0' and
 posXBullet >= posXInvader (i) and
 posXbullet <= posXInvader (i) + sizeInvader and
 posYBullet >= posYInvader (i) and
 posYBullet <= posYInvader (i) + sizeInvader
) then
                    
                    hideInvader(i) <= '1'; -- Ocultamos el invasor
                    collision <= '1';      -- Flag de colisión a 1 para que se resetee la bala
                end if;
                -- Si algún invasor llega abajo de la pantalla entonces perdemos
                if(posYInvader(i) >= 900 and hideInvader(i) = '0') then
                    gameOver <= '1';
                end if;
                if(reset = '1') then
                    gameover <= '0';
                end if;

            end loop;
        end if;


    end process;

    renderP: process (X, Y, gameOver, x_position)
    begin
        -- Si perdemos o tenemos 0 vidas mostramos una pantalla con el texto "GAME OVER!"
        if( gameOver = '1' or lives = 0) then
            if (draw_string(X, Y, centerX, centerY, "GAME OVER!", true, 5)) then
                Red <= 15;
                Green <= 15;
                Blue <= 0;
            else
                Red <= 0;
                Green <= 0;
                Blue <= 0;
            end if;
        -- Si todos los invasores están ocultos mostramos la pantalla de ganador
        elsif(hideInvader = "111111111111111111111111111") then
            if (draw_string(X, Y, centerX, centerY, "YOU HAVE WON!", true, 5)) then
                Red <= 15;
                Green <= 15;
                Blue <= 0;
            else
                Red <= 0;
                Green <= 0;
                Blue <= 0;
            end if;
        else
            -- Mostramos el número de vidas
            if(lives = 3 and draw_string(X, Y, 10, 10, "Vidas: @@@" , false, 2)) then
                Red <= 0;
                Green <= 15;
                Blue <= 0;
            elsif(lives = 2 and draw_string(X, Y, 10, 10, "Vidas: @@" , false, 2)) then
                Red <= 0;
                Green <= 15;
                Blue <= 0;
            elsif(lives = 1 and draw_string(X, Y, 10, 10, "Vidas: @" , false, 2)) then
                Red <= 0;
                Green <= 15;
                Blue <= 0;
            -- Mostramos el título del juego
            elsif(draw_string(X, Y, centerX, 30, "SQUARE INVADERS" , true, 3)) then
                Red <= 0;
                Green <= 15;
                Blue <= 15;
            -- Dibujamos la bala
            elsif(hideBullet = '0' and collision = '0' and Y > posYBullet  and Y < posYBullet + sizeYBullet and X > posXBullet  and X < posXBullet + sizeXBullet ) then
                Red <= 15;
                Green <= 5;
                Blue <= 5;
            -- Si NO somos invencibles dibujamos a la nave de rojo
            elsif(invencibilityTimer = 0 and Y > posY and Y < posY + sizeOfGuy and X > posX and X < posX + sizeOfGuy ) then
                Red <= 15;
                Green <= 0;
                Blue <= 0;
            -- Si somos invencibles dibujamos a la nave de naranja
            elsif(invencibilityTimer > 0 and Y > posY and Y < posY + sizeOfGuy and X > posX and X < posX + sizeOfGuy ) then
                Red <= 15;
                Green <= 7;
                Blue <= 0;
            -- Dibujamos la barra de invencibilidad
            elsif(invencibilityTimer > 0 and Y > centerY + 120 - (invencibilityTimer) and Y < centerY + 120 and X > 20 and X < 40 ) then
                Red <= 15;
                Green <= 7;
                Blue <= 0;
            -- Dibujamos el fondo de negro
            else
                Red <= 0;
                Green <= 0;
                Blue <= 0;
            end if;
            -- Por cada i invasor...
            for i in 0 to 26 loop
                -- Dibujamos al invasor
                if(hideInvader(i) = '0' and Y > posYInvader(i) and Y < posYInvader(i) + sizeInvader and X > posXInvader(i) and X < posXInvader(i) + sizeInvader ) then
                    Red <= 10;
                    Green <= 15;
                    Blue <= 5;
                end if;
                -- Dibujamos cada bala de cada invasor
                if(hideBulletInvader(i) = '0' and 
                Y > bulletInvaderY(i) and Y < bulletInvaderY(i) + sizeYBullet and X > bulletInvaderX(i) and X < bulletInvaderX(i) + sizeXBullet) then
                    Red <= 10;
                    Green <= 5;
                    Blue <= 5;
                end if;
            end loop;
            
        end if;
    end process;

end Behavioral;